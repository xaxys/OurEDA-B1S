# 控制板STM32H750主程序

最新程序为`file_rebuild` ，移植了新版本的ROV驱动库

该仓的STM32负责漏水检测、温湿度大气压传感器、水深传感器、九轴的控制功能

同时可以自主实现PID定向定深

PID定向模式：保证ROV航向不变

PID定深模式：保证ROV所处深度不变

使用FreeRTOS进行任务调度，但仅仅使用了其中的任务调度功能，并未使用信号量、消息队列等功能（主要是因为原作者懒得用），下一迭代可能会考虑充分使用这些功能以增强系统稳定性

主要文件：

* main.c：分配任务和基本控制逻辑
* BasicCtrl.c：基本控制函数库文件，一直沿用到现在的推进器控制代码
* Sensor.c：传感器处理函数库文件

## 初步测试结果

1. 上电后stm32h7无任何反应
2. 温湿度传感器输出正常
3. 九轴传感器输出正常
4. 深度解算板（stm32f1）输出正常
5. MT7621工作正常，但WAN口无法连接外网，所有LAN口正常工作
6. USB无法连接
7. openwrt开机缓慢

准备进行初步Debug

### Dubug结果

1. 修复路由器模块WAN口问题、USB问题
2. 重新刷写openwrt固件到19.07版本
3. 成功安装需要的软件
4. 修复stm32h750所有问题

## 再次测试结果

1. stm32h750上传数据、下传指令功能正常
2. 未验证上传数据内容是否正常，但是指令长度、传感器变化、开始标志位、结束标志位均存在，待后续测试
3. 未验证下传指令速率，存在未上电时控制指令紊乱的情况
4. 通常USB设备可以连接，但无法连接uvc免驱USB摄像头
5. openwrt可以接收到串口数据，但未测试串口转网口功能
6. openwrt其他功能正常

### 上传数据测试结果

1. 湿度上传**可能**存在问题（正常值60，传感器上报80）
2. 水深上传存在问题
3. 欧拉角上传可能存在问题

### Bug修复结果

1. 修复温湿度大气压传感器数据问题
2. 可能修复欧拉角上传数据问题
3. **发现水深水温传感器数据传输卡死**